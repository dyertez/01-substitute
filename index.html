<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ระบบลงทะเบียนข้อมูลรายวิชาและครูผู้สอน</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;500;700&display=swap">
    <!-- SheetJS for Excel Export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        body {
            font-family: 'Sarabun', sans-serif;
        }
        .main-tab-active { background-color: #4f46e5; color: white; }
        .view-mode-btn.active { background-color: #4f46e5; color: white; }
        .dynamic-tab.active { border-color: #4f46e5; color: #4f46e5; background-color: #eef2ff; }
        .view-container { display: none; }
        .view-container.active { display: block; }
        .table-container { display: none; }
        .table-container.active { display: block; }
        .room-cell { cursor: pointer; user-select: none; transition: background-color: 0.2s; }
        .room-cell:hover { background-color: #ebf4ff; }
        .modal-backdrop { background-color: rgba(0, 0, 0, 0.5); transition: opacity: 0.3s ease; }
        #notification {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 12px 24px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
        }
        #notification.show {
            opacity: 1;
            visibility: visible;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <div class="container mx-auto p-4 sm:p-6 md:p-8">
        <header class="text-center mb-4">
            <div class="flex justify-center items-center">
                <h1 class="text-3xl sm:text-4xl font-bold text-indigo-700">ระบบลงทะเบียนข้อมูลรายวิชาและครูผู้สอน</h1>
            </div>
            <p class="text-gray-600 mt-2">โรงเรียนตัวอย่างวิทยาคม</p>
        </header>

        <!-- Main Tabs -->
        <div class="mb-6 flex justify-center border-b border-gray-200">
             <div class="flex justify-center items-center gap-4 w-full pb-2 flex-wrap">
                <div class="flex bg-gray-200 rounded-lg p-1 text-sm sm:text-base">
                    <button onclick="changeMainView('teacherList')" id="teacherList-main-tab" class="main-tab-active px-3 sm:px-6 py-2 font-medium rounded-md">รายชื่อครู</button>
                    <button onclick="changeMainView('courses')" id="courses-main-tab" class="px-3 sm:px-6 py-2 font-medium rounded-md">รายวิชา</button>
                </div>
                <div class="flex bg-gray-200 rounded-lg p-1 text-sm sm:text-base">
                    <button onclick="changeMainView('teaching')" id="teaching-main-tab" class="px-3 sm:px-6 py-2 font-medium rounded-md">ลงทะเบียนสอน</button>
                    <button onclick="changeMainView('teachers')" id="teachers-main-tab" class="px-3 sm:px-6 py-2 font-medium rounded-md">สรุปคาบสอน</button>
                </div>
            </div>
        </div>
        
        <main>
            <!-- Teacher List View -->
            <div id="teacherList-view" class="view-container active">
                <!-- Moved Buttons Above Header -->
                <div class="flex justify-end items-center mb-4 gap-4">
                    <button onclick="downloadTeacherTemplate()" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg transition-colors flex items-center gap-2 text-sm">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                          <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd" />
                        </svg>
                        <span>ตัวอย่าง ไฟล์รายชื่อครู</span>
                    </button>
                    <input type="file" id="teacher-upload-input" class="hidden" accept=".xlsx, .xls" onchange="handleTeacherFileUpload(event)">
                    <button onclick="document.getElementById('teacher-upload-input').click()" class="bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-2 px-4 rounded-lg transition-colors flex items-center gap-2 text-sm">
                       <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                         <path d="M5.5 13a3.5 3.5 0 01-.369-6.98 4 4 0 117.753-1.977A4.5 4.5 0 1113.5 13H11V9.414l-1.293 1.293a1 1 0 01-1.414-1.414l3-3a1 1 0 011.414 0l3 3a1 1 0 01-1.414 1.414L13 9.414V13H5.5z" />
                         <path d="M9 13h2v5a1 1 0 11-2 0v-5z" />
                       </svg>
                       <span>อัปโหลดไฟล์</span>
                    </button>
                </div>
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-2xl font-semibold text-gray-700">รายชื่อครู</h2>
                    <div class="flex items-center gap-4">
                        <div id="teacherList-controls"></div>
                        <button onclick="addTeacher()" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-lg transition-colors">เพิ่มครู</button>
                    </div>
                </div>
                <div class="border-b border-gray-200">
                    <nav id="teacherList-dynamic-tabs" class="-mb-px flex flex-wrap gap-x-4 sm:gap-x-6" aria-label="Tabs"></nav>
                </div>
                <div id="teacherList-tables-container" class="mt-6"></div>
            </div>

            <!-- Course Registration View -->
            <div id="courses-view" class="view-container">
                 <!-- Moved Buttons Above Header -->
                 <div class="flex justify-end items-center mb-4 gap-4">
                    <button onclick="downloadCourseTemplate()" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg transition-colors flex items-center gap-2 text-sm">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                          <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd" />
                        </svg>
                        <span>ตัวอย่าง ไฟล์รายวิชา</span>
                    </button>
                    <input type="file" id="course-upload-input" class="hidden" accept=".xlsx, .xls" onchange="handleCourseFileUpload(event)">
                    <button onclick="document.getElementById('course-upload-input').click()" class="bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-2 px-4 rounded-lg transition-colors flex items-center gap-2 text-sm">
                       <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                         <path d="M5.5 13a3.5 3.5 0 01-.369-6.98 4 4 0 117.753-1.977A4.5 4.5 0 1113.5 13H11V9.414l-1.293 1.293a1 1 0 01-1.414-1.414l3-3a1 1 0 011.414 0l3 3a1 1 0 01-1.414 1.414L13 9.414V13H5.5z" />
                         <path d="M9 13h2v5a1 1 0 11-2 0v-5z" />
                       </svg>
                       <span>อัปโหลดไฟล์</span>
                    </button>
                </div>
                 <div class="flex justify-between items-center mb-4">
                    <h2 class="text-2xl font-semibold text-gray-700">รายวิชา</h2>
                     <div class="flex items-center gap-4">
                        <div id="course-controls"></div>
                    </div>
                </div>
                <div class="border-b border-gray-200">
                    <nav id="course-dynamic-tabs" class="-mb-px flex flex-wrap gap-x-4 sm:gap-x-6" aria-label="Tabs"></nav>
                </div>
                <div id="course-tables-container" class="mt-6"></div>
            </div>

            <!-- Teaching Assignment View -->
            <div id="teaching-view" class="view-container">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-2xl font-semibold text-gray-700">ลงทะเบียนสอน</h2>
                    <div id="teaching-controls" class="flex justify-end"></div>
                </div>
                <div class="border-b border-gray-200">
                    <nav id="teaching-dynamic-tabs" class="-mb-px flex flex-wrap gap-x-4 sm:gap-x-6" aria-label="Tabs"></nav>
                </div>
                <div id="teaching-tables-container" class="mt-6"></div>
            </div>

            <!-- Teacher Summary View -->
            <div id="teachers-view" class="view-container">
                 <div class="flex justify-between items-center mb-4">
                    <h2 class="text-2xl font-semibold text-gray-700">สรุปคาบสอน</h2>
                    <div class="flex items-center gap-4">
                        <div id="teacher-summary-controls" class="flex justify-end"></div>
                    </div>
                 </div>
                 <div class="border-b border-gray-200">
                    <nav id="teacher-dynamic-tabs" class="-mb-px" aria-label="Tabs"></nav>
                </div>
                <div id="teacher-tables-container" class="mt-6"></div>
            </div>
        </main>
    </div>

    <!-- Modals -->
    <div id="teacher-selector-modal" class="fixed inset-0 z-50 flex items-center justify-center p-4 hidden modal-backdrop"></div>
    <div id="notification"></div>

    <script>
        // --- DATA STORE ---
        let courseTeachingViewMode = 'grade';
        let teacherListViewMode = 'all';
        let teacherSummaryViewMode = 'grade';
        let modalSelectedTeacherIds = [];
        const LEARNING_AREAS = ['01 ไทย', '02 คณิต', '03 วิทย์', '04 คอม', '05 สังคม', '06 พละ', '07 ศิลปะ', '08 การงาน', '09 ต่างประเทศ', '10 แนะแนว'];

        let courseData = {
            'm1': { name: 'ม. 1', courses: [
                { id: 'ท21101', name: 'ภาษาไทย 1', periods: 3, credits: 1.5, rooms: [1,2,3,4,5,6], learningArea: '01 ไทย' },
                { id: 'ค21101', name: 'คณิตศาสตร์ 1', periods: 3, credits: 1.5, rooms: [1,2,3,4,5,6], learningArea: '02 คณิต' },
                { id: 'ว21101', name: 'วิทยาศาสตร์ 1', periods: 3, credits: 1.5, rooms: [1,2,3,4,5,6], learningArea: '03 วิทย์' },
                { id: 'ส21101', name: 'สังคมศึกษา 1', periods: 2, credits: 1.0, rooms: [1,2,3,4,5,6], learningArea: '05 สังคม' },
                { id: 'พ21101', name: 'สุขศึกษาและพลศึกษา 1', periods: 2, credits: 1.0, rooms: [1,2,3,4,5,6], learningArea: '06 พละ' },
                { id: 'ศ21101', name: 'ศิลปะ 1', periods: 2, credits: 1.0, rooms: [1,2,3,4,5,6], learningArea: '07 ศิลปะ' },
                { id: 'ง21101', name: 'การงานอาชีพ 1', periods: 2, credits: 1.0, rooms: [1,2,3,4,5,6], learningArea: '08 การงาน' },
                { id: 'อ21101', name: 'ภาษาอังกฤษ 1', periods: 3, credits: 1.5, rooms: [1,2,3,4,5,6], learningArea: '09 ต่างประเทศ' },
                { id: 'ว21103', name: 'วิทยาการคำนวณ 1', periods: 2, credits: 1.0, rooms: [1,2,3,4,5,6], learningArea: '04 คอม' },
                { id: 'แ21101', name: 'แนะแนว 1', periods: 1, credits: 0.5, rooms: [1,2,3,4,5,6], learningArea: '10 แนะแนว' },
            ]},
            'm2': { name: 'ม. 2', courses: [
                { id: 'ท22101', name: 'ภาษาไทย 3', periods: 3, credits: 1.5, rooms: [1,2,3,4,5], learningArea: '01 ไทย' },
                { id: 'ค22101', name: 'คณิตศาสตร์ 3', periods: 3, credits: 1.5, rooms: [1,2,3,4,5], learningArea: '02 คณิต' },
                { id: 'ว22101', name: 'วิทยาศาสตร์ 3', periods: 3, credits: 1.5, rooms: [1,2,3,4,5], learningArea: '03 วิทย์' },
                { id: 'อ22101', name: 'ภาษาอังกฤษ 3', periods: 3, credits: 1.5, rooms: [1,2,3,4,5], learningArea: '09 ต่างประเทศ' },
            ]},
            'm3': { name: 'ม. 3', courses: [
                { id: 'ท23101', name: 'ภาษาไทย 5', periods: 3, credits: 1.5, rooms: [1,2,3,4], learningArea: '01 ไทย' },
                { id: 'ค23101', name: 'คณิตศาสตร์ 5', periods: 3, credits: 1.5, rooms: [1,2,3,4], learningArea: '02 คณิต' },
                { id: 'ว23101', name: 'วิทยาศาสตร์ 5', periods: 3, credits: 1.5, rooms: [1,2,3,4], learningArea: '03 วิทย์' },
                { id: 'อ23101', name: 'ภาษาอังกฤษ 5', periods: 3, credits: 1.5, rooms: [1,2,3,4], learningArea: '09 ต่างประเทศ' },
            ]},
            'm4': { name: 'ม. 4', courses: [
                { id: 'ท31101', name: 'ภาษาไทยพื้นฐาน', periods: 2, credits: 1.0, rooms: [1,2,3,4,5,6,7,8], learningArea: '01 ไทย' },
                { id: 'ค31101', name: 'คณิตศาสตร์พื้นฐาน', periods: 2, credits: 1.0, rooms: [1,2,3,4,5,6,7,8], learningArea: '02 คณิต' },
                { id: 'ว30201', name: 'ฟิสิกส์ 1', periods: 3, credits: 1.5, rooms: [1,2,3], learningArea: '03 วิทย์' },
                { id: 'ว30221', name: 'เคมี 1', periods: 3, credits: 1.5, rooms: [1,2,3], learningArea: '03 วิทย์' },
                { id: 'ว30241', name: 'ชีววิทยา 1', periods: 3, credits: 1.5, rooms: [1,2,3], learningArea: '03 วิทย์' },
                { id: 'อ31201', name: 'ภาษาอังกฤษอ่าน-เขียน 1', periods: 2, credits: 1.0, rooms: [4,5,6,7,8], learningArea: '09 ต่างประเทศ' },
                { id: 'จ31201', name: 'ภาษาจีน 1', periods: 2, credits: 1.0, rooms: [4,5], learningArea: '09 ต่างประเทศ' },
                { id: 'ศ31101', name: 'ดนตรีสากล', periods: 2, credits: 1.0, rooms: [6,7,8], learningArea: '07 ศิลปะ' },
            ]},
            'm5': { name: 'ม. 5', courses: [
                { id: 'ท32101', name: 'หลักภาษาไทย', periods: 2, credits: 1.0, rooms: [1,2,3,4,5,6,7], learningArea: '01 ไทย' },
                { id: 'ค32201', name: 'คณิตศาสตร์เพิ่มเติม 3', periods: 4, credits: 2.0, rooms: [1,2,3], learningArea: '02 คณิต' },
                { id: 'ว30203', name: 'ฟิสิกส์ 3', periods: 3, credits: 1.5, rooms: [1,2,3], learningArea: '03 วิทย์' },
                { id: 'ว30223', name: 'เคมี 3', periods: 3, credits: 1.5, rooms: [1,2,3], learningArea: '03 วิทย์' },
                { id: 'ง32201', name: 'การเขียนโปรแกรม', periods: 3, credits: 1.5, rooms: [4,5,6,7], learningArea: '04 คอม' },
            ]},
            'm6': { name: 'ม. 6', courses: [
                { id: 'ท33101', name: 'วรรณคดีวิจักษ์', periods: 2, credits: 1.0, rooms: [1,2,3,4,5,6], learningArea: '01 ไทย' },
                { id: 'ค33201', name: 'คณิตศาสตร์เพิ่มเติม 5', periods: 4, credits: 2.0, rooms: [1,2,3], learningArea: '02 คณิต' },
                { id: 'ส33102', name: 'กฎหมายน่ารู้', periods: 2, credits: 1.0, rooms: [1,2,3,4,5,6], learningArea: '05 สังคม' },
                { id: 'อ33201', name: 'ภาษาอังกฤษเพื่อการศึกษาต่อ', periods: 2, credits: 1.0, rooms: [1,2,3,4,5,6], learningArea: '09 ต่างประเทศ' },
            ]},
        };

        let teacherData = [
            { id: 101, title: 'นาย', firstName: 'ครูภาษาไทย 01', lastName: 'ThaiTeacher 01', learningArea: '01 ไทย' }, { id: 102, title: 'นางสาว', firstName: 'ครูภาษาไทย 02', lastName: 'ThaiTeacher 02', learningArea: '01 ไทย' }, { id: 103, title: 'นาง', firstName: 'ครูภาษาไทย 03', lastName: 'ThaiTeacher 03', learningArea: '01 ไทย' }, { id: 104, title: 'นาย', firstName: 'ครูภาษาไทย 04', lastName: 'ThaiTeacher 04', learningArea: '01 ไทย' }, { id: 105, title: 'นางสาว', firstName: 'ครูภาษาไทย 05', lastName: 'ThaiTeacher 05', learningArea: '01 ไทย' },
            { id: 201, title: 'นาย', firstName: 'ครูคณิตศาสตร์ 01', lastName: 'MathTeacher 01', learningArea: '02 คณิต' }, { id: 202, title: 'นางสาว', firstName: 'ครูคณิตศาสตร์ 02', lastName: 'MathTeacher 02', learningArea: '02 คณิต' }, { id: 203, title: 'นาย', firstName: 'ครูคณิตศาสตร์ 03', lastName: 'MathTeacher 03', learningArea: '02 คณิต' }, { id: 204, title: 'นาง', firstName: 'ครูคณิตศาสตร์ 04', lastName: 'MathTeacher 04', learningArea: '02 คณิต' }, { id: 205, title: 'นาย', firstName: 'ครูคณิตศาสตร์ 05', lastName: 'MathTeacher 05', learningArea: '02 คณิต' },
            { id: 301, title: 'นาย', firstName: 'ครูวิทย์ 01', lastName: 'SciTeacher 01', learningArea: '03 วิทย์' }, { id: 302, title: 'นางสาว', firstName: 'ครูวิทย์ 02', lastName: 'SciTeacher 02', learningArea: '03 วิทย์' }, { id: 303, title: 'นาย', firstName: 'ครูวิทย์ 03', lastName: 'SciTeacher 03', learningArea: '03 วิทย์' }, { id: 304, title: 'นาง', firstName: 'ครูวิทย์ 04', lastName: 'SciTeacher 04', learningArea: '03 วิทย์' }, { id: 305, title: 'นาย', firstName: 'ครูวิทย์ 05', lastName: 'SciTeacher 05', learningArea: '03 วิทย์' },
            { id: 901, title: 'นาย', firstName: 'ครูคอม 01', lastName: 'ComTeacher 01', learningArea: '04 คอม' }, { id: 902, title: 'นางสาว', firstName: 'ครูคอม 02', lastName: 'ComTeacher 02', learningArea: '04 คอม' }, { id: 903, title: 'นาย', firstName: 'ครูคอม 03', lastName: 'ComTeacher 03', learningArea: '04 คอม' }, { id: 904, title: 'นาง', firstName: 'ครูคอม 04', lastName: 'ComTeacher 04', learningArea: '04 คอม' }, { id: 905, title: 'นาย', firstName: 'ครูคอม 05', lastName: 'ComTeacher 05', learningArea: '04 คอม' },
            { id: 401, title: 'นาย', firstName: 'ครูสังคม 01', lastName: 'SocialTeacher 01', learningArea: '05 สังคม' }, { id: 402, title: 'นางสาว', firstName: 'ครูสังคม 02', lastName: 'SocialTeacher 02', learningArea: '05 สังคม' }, { id: 403, title: 'นาย', firstName: 'ครูสังคม 03', lastName: 'SocialTeacher 03', learningArea: '05 สังคม' }, { id: 404, title: 'นาง', firstName: 'ครูสังคม 04', lastName: 'SocialTeacher 04', learningArea: '05 สังคม' }, { id: 405, title: 'นาย', firstName: 'ครูสังคม 05', lastName: 'SocialTeacher 05', learningArea: '05 สังคม' },
            { id: 501, title: 'นาย', firstName: 'ครูพละ 01', lastName: 'PETeacher 01', learningArea: '06 พละ' }, { id: 502, title: 'นางสาว', firstName: 'ครูพละ 02', lastName: 'PETeacher 02', learningArea: '06 พละ' }, { id: 503, title: 'นาย', firstName: 'ครูพละ 03', lastName: 'PETeacher 03', learningArea: '06 พละ' }, { id: 504, title: 'นาง', firstName: 'ครูพละ 04', lastName: 'PETeacher 04', learningArea: '06 พละ' }, { id: 505, title: 'นาย', firstName: 'ครูพละ 05', lastName: 'PETeacher 05', learningArea: '06 พละ' },
            { id: 601, title: 'นาย', firstName: 'ครูศิลปะ 01', lastName: 'ArtTeacher 01', learningArea: '07 ศิลปะ' }, { id: 602, title: 'นางสาว', firstName: 'ครูศิลปะ 02', lastName: 'ArtTeacher 02', learningArea: '07 ศิลปะ' }, { id: 603, title: 'นาย', firstName: 'ครูศิลปะ 03', lastName: 'ArtTeacher 03', learningArea: '07 ศิลปะ' }, { id: 604, title: 'นาง', firstName: 'ครูศิลปะ 04', lastName: 'ArtTeacher 04', learningArea: '07 ศิลปะ' }, { id: 605, title: 'นาย', firstName: 'ครูศิลปะ 05', lastName: 'ArtTeacher 05', learningArea: '07 ศิลปะ' },
            { id: 701, title: 'นาย', firstName: 'ครูการงาน 01', lastName: 'WorkTeacher 01', learningArea: '08 การงาน' }, { id: 702, title: 'นางสาว', firstName: 'ครูการงาน 02', lastName: 'WorkTeacher 02', learningArea: '08 การงาน' }, { id: 703, title: 'นาย', firstName: 'ครูการงาน 03', lastName: 'WorkTeacher 03', learningArea: '08 การงาน' }, { id: 704, title: 'นาง', firstName: 'ครูการงาน 04', lastName: 'WorkTeacher 04', learningArea: '08 การงาน' }, { id: 705, title: 'นาย', firstName: 'ครูการงาน 05', lastName: 'WorkTeacher 05', learningArea: '08 การงาน' },
            { id: 801, title: 'นาย', firstName: 'ครูอังกฤษ 01', lastName: 'EngTeacher 01', learningArea: '09 ต่างประเทศ' }, { id: 802, title: 'นางสาว', firstName: 'ครูอังกฤษ 02', lastName: 'EngTeacher 02', learningArea: '09 ต่างประเทศ' }, { id: 803, title: 'นาย', firstName: 'ครูจีน 01', lastName: 'ChineseTeacher 01', learningArea: '09 ต่างประเทศ' }, { id: 804, title: 'นาง', firstName: 'ครูญี่ปุ่น 01', lastName: 'JapanTeacher 01', learningArea: '09 ต่างประเทศ' }, { id: 805, title: 'นาย', firstName: 'ครูฝรั่งเศส 01', lastName: 'FrenchTeacher 01', learningArea: '09 ต่างประเทศ' },
            { id: 1001, title: 'นาย', firstName: 'ครูแนะแนว 01', lastName: 'GuidanceTeacher 01', learningArea: '10 แนะแนว' }, { id: 1002, title: 'นางสาว', firstName: 'ครูแนะแนว 02', lastName: 'GuidanceTeacher 02', learningArea: '10 แนะแนว' }, { id: 1003, title: 'นาย', firstName: 'ครูแนะแนว 03', lastName: 'GuidanceTeacher 03', learningArea: '10 แนะแนว' }, { id: 1004, title: 'นาง', firstName: 'ครูแนะแนว 04', lastName: 'GuidanceTeacher 04', learningArea: '10 แนะแนว' }, { id: 1005, title: 'นาย', firstName: 'ครูแนะแนว 05', lastName: 'GuidanceTeacher 05', learningArea: '10 แนะแนว' },
        ];
        
        let teachingAssignments = {
            'ท21101_1': [101], 'ท21101_2': [101], 'ท21101_3': [102], 'ท21101_4': [102], 'ท21101_5': [103], 'ท21101_6': [103],
            'ค21101_1': [201], 'ค21101_2': [201], 'ค21101_3': [202], 'ค21101_4': [202], 'ค21101_5': [203], 'ค21101_6': [203],
            'ว21101_1': [301], 'ว21101_2': [301], 'ว21101_3': [302], 'ว21101_4': [302], 'ว21101_5': [303], 'ว21101_6': [303],
            'ส21101_1': [401], 'ส21101_2': [401], 'ส21101_3': [402], 'ส21101_4': [402], 'ส21101_5': [401], 'ส21101_6': [402],
            'พ21101_1': [501], 'พ21101_2': [502], 'พ21101_3': [501], 'พ21101_4': [502], 'พ21101_5': [501], 'พ21101_6': [502],
            'ศ21101_1': [601], 'ศ21101_2': [601], 'ศ21101_3': [602], 'ศ21101_4': [602], 'ศ21101_5': [603], 'ศ21101_6': [603],
            'ง21101_1': [701], 'ง21101_2': [701], 'ง21101_3': [702], 'ง21101_4': [702], 'ง21101_5': [701], 'ง21101_6': [702],
            'อ21101_1': [801], 'อ21101_2': [801], 'อ21101_3': [802], 'อ21101_4': [802], 'อ21101_5': [801, 802], 'อ21101_6': [801, 802],
            'ว21103_1': [901], 'ว21103_2': [901], 'ว21103_3': [902], 'ว21101_4': [902], 'ว21103_5': [903], 'ว21103_6': [903],
            'แ21101_1': [1001], 'แ21101_2': [1001], 'แ21101_3': [1002], 'แ21101_4': [1002], 'แ21101_5': [1003], 'แ21101_6': [1003],
            'ท31101_1': [104], 'ท31101_2': [104], 'ท31101_3': [104], 'ท31101_4': [105], 'ท31101_5': [105], 'ท31101_6': [105],
            'ค31101_1': [204], 'ค31101_2': [204], 'ค31101_3': [204], 'ค31101_4': [205], 'ค31101_5': [205], 'ค31101_6': [205],
            'ว30201_1': [304], 'ว30201_2': [304], 'ว30201_3': [305],
            'ว30221_1': [304], 'ว30221_2': [304], 'ว30221_3': [305],
            'จ31201_4': [803], 'จ31201_5': [803],
            'ง32201_4': [904], 'ง32201_5': [904], 'ง32201_6': [905], 'ง32201_7': [905],
        };

        // --- INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', () => {
            loadDataFromLocalStorage(); // Load saved data first
            renderAllViews();
        });

        function renderAllViews() {
            const activeTabs = getActiveTabs();
            renderTeacherListView();
            renderDynamicView('course');
            renderDynamicView('teaching');
            renderDynamicView('teacher');
            restoreActiveTabs(activeTabs);
        }

        // --- DYNAMIC VIEW RENDERING ---
        function renderDynamicView(viewPrefix) {
            const controlsContainer = document.getElementById(`${viewPrefix}-controls`);
            if (controlsContainer) {
                controlsContainer.innerHTML = `
                    <div class="flex bg-gray-200 rounded-lg p-1 text-sm">
                        <button onclick="setCourseTeachingViewMode('grade')" class="view-mode-btn ${courseTeachingViewMode === 'grade' ? 'active' : ''} px-4 py-1 rounded-md font-medium" data-mode="grade">ระดับชั้น</button>
                        <button onclick="setCourseTeachingViewMode('learningArea')" class="view-mode-btn ${courseTeachingViewMode === 'learningArea' ? 'active' : ''} px-4 py-1 rounded-md font-medium" data-mode="learningArea">กลุ่มสาระ</button>
                    </div>`;
            }

            if (viewPrefix === 'course' || viewPrefix === 'teaching') {
                if (courseTeachingViewMode === 'grade') {
                    renderCourseOrTeachingViewByGrade(viewPrefix);
                } else {
                    renderCourseOrTeachingViewByLearningArea(viewPrefix);
                }
            } else if (viewPrefix === 'teacher') {
                 const summaryControls = document.getElementById('teacher-summary-controls');
                 if(summaryControls) {
                     summaryControls.innerHTML = `
                        <div class="flex bg-gray-200 rounded-lg p-1 text-sm">
                            <button onclick="setTeacherSummaryViewMode('grade')" class="view-mode-btn ${teacherSummaryViewMode === 'grade' ? 'active' : ''} px-4 py-1 rounded-md font-medium">ระดับชั้น</button>
                            <button onclick="setTeacherSummaryViewMode('learningArea')" class="view-mode-btn ${teacherSummaryViewMode === 'learningArea' ? 'active' : ''} px-4 py-1 rounded-md font-medium">กลุ่มสาระ</button>
                        </div>`;
                 }
                 if (teacherSummaryViewMode === 'grade') {
                    renderTeacherSummaryByGrade();
                } else {
                    renderTeacherSummaryByLearningArea();
                }
            }
        }
        
        // --- Teacher List View ---
        function renderTeacherListView() {
            const controlsContainer = document.getElementById('teacherList-controls');
            controlsContainer.innerHTML = `
                <div class="flex bg-gray-200 rounded-lg p-1 text-sm">
                    <button onclick="setTeacherListViewMode('all')" class="view-mode-btn ${teacherListViewMode === 'all' ? 'active' : ''} px-4 py-1 rounded-md font-medium">ทั้งหมด</button>
                    <button onclick="setTeacherListViewMode('learningArea')" class="view-mode-btn ${teacherListViewMode === 'learningArea' ? 'active' : ''} px-4 py-1 rounded-md font-medium">กลุ่มสาระ</button>
                </div>`;

            if (teacherListViewMode === 'all') {
                renderTeacherListAll();
            } else {
                renderTeacherListByArea();
            }
        }

        function setTeacherListViewMode(mode) {
            if (teacherListViewMode === mode) return;
            teacherListViewMode = mode;
            renderTeacherListView();
        }

        function renderTeacherListAll() {
            const tabsContainer = document.getElementById('teacherList-dynamic-tabs');
            const tablesContainer = document.getElementById('teacherList-tables-container');
            tabsContainer.innerHTML = '';
            tablesContainer.innerHTML = '';

            const tableId = `teacherList_all_combined`;
            tablesContainer.insertAdjacentHTML('beforeend', createTeacherListTableShell(tableId, true));
            const tableBody = tablesContainer.querySelector(`#${tableId} tbody`);
            
            LEARNING_AREAS.forEach(area => {
                const teachersInArea = teacherData.filter(t => t.learningArea === area);
                if (teachersInArea.length === 0) return;

                tableBody.innerHTML += `
                    <tr class="bg-gray-100">
                        <td colspan="5" class="px-6 py-2 text-md font-semibold text-gray-800">${area}</td>
                    </tr>
                `;
                populateTeacherListTable(tableBody, teachersInArea);
            });
        }

        function renderTeacherListByArea() {
            const tabsContainer = document.getElementById('teacherList-dynamic-tabs');
            const tablesContainer = document.getElementById('teacherList-tables-container');
            tabsContainer.innerHTML = '';
            tablesContainer.innerHTML = '';

            LEARNING_AREAS.forEach(area => {
                const teachersInArea = teacherData.filter(t => t.learningArea === area);
                if (teachersInArea.length === 0) return;

                const isActive = tabsContainer.innerHTML === '';
                const areaId = area.replace(/\s+/g, '');
                tabsContainer.innerHTML += `<button onclick="changeActiveTab(event)" data-target="teacherList_${areaId}" class="dynamic-tab ${isActive ? 'active' : ''} shrink-0 border-b-2 font-medium px-1 py-4 text-sm">${area}</button>`;

                const tableId = `teacherList_${areaId}`;
                tablesContainer.insertAdjacentHTML('beforeend', createTeacherListTableShell(tableId, isActive));
                const tableBody = tablesContainer.querySelector(`#${tableId} tbody`);
                populateTeacherListTable(tableBody, teachersInArea);
            });
        }

        function populateTeacherListTable(tableBody, teachers) {
            teachers.forEach(teacher => {
                tableBody.innerHTML += `
                    <tr class="hover:bg-gray-50">
                        <td class="px-6 py-3 whitespace-nowrap text-sm text-gray-900 border-b border-gray-200 border-r">${teacher.id}</td>
                        <td class="px-6 py-3 whitespace-nowrap text-sm text-gray-700 border-b border-gray-200 border-r">${teacher.title}</td>
                        <td class="px-6 py-3 whitespace-nowrap text-sm text-gray-700 border-b border-gray-200 border-r">${teacher.firstName}</td>
                        <td class="px-6 py-3 whitespace-nowrap text-sm text-gray-700 border-b border-gray-200 border-r">${teacher.lastName}</td>
                        <td class="px-6 py-3 whitespace-nowrap text-sm text-gray-700 border-b border-gray-200">${teacher.learningArea}</td>
                    </tr>
                `;
            });
        }

        function renderCourseOrTeachingViewByGrade(viewPrefix) {
            const tabsContainer = document.getElementById(`${viewPrefix}-dynamic-tabs`);
            const tablesContainer = document.getElementById(`${viewPrefix}-tables-container`);
            tabsContainer.innerHTML = '';
            tablesContainer.innerHTML = '';

            Object.keys(courseData).forEach((gradeKey, index) => {
                const isActive = index === 0;
                tabsContainer.innerHTML += `<button onclick="changeActiveTab(event)" data-target="${viewPrefix}_${gradeKey}" class="dynamic-tab ${isActive ? 'active' : ''} shrink-0 border-b-2 font-medium px-1 py-4 text-sm">${courseData[gradeKey].name}</button>`;
                
                const tableId = `${viewPrefix}_${gradeKey}`;
                tablesContainer.insertAdjacentHTML('beforeend', createCourseTableShell(tableId, isActive));
                const tableBody = tablesContainer.querySelector(`#${tableId} tbody`);
                const courses = courseData[gradeKey].courses;

                populateCourseTableBody(tableBody, courses, viewPrefix);
            });
        }

        function renderCourseOrTeachingViewByLearningArea(viewPrefix) {
            const tabsContainer = document.getElementById(`${viewPrefix}-dynamic-tabs`);
            const tablesContainer = document.getElementById(`${viewPrefix}-tables-container`);
            tabsContainer.innerHTML = '';
            tablesContainer.innerHTML = '';

            const allCourses = Object.values(courseData).flatMap(grade => grade.courses);
            
            LEARNING_AREAS.forEach((area) => {
                const coursesInArea = allCourses.filter(c => c.learningArea === area);
                if (coursesInArea.length === 0) return;

                const isActive = tabsContainer.innerHTML === '';
                const areaId = area.replace(/\s+/g, '');
                tabsContainer.innerHTML += `<button onclick="changeActiveTab(event)" data-target="${viewPrefix}_${areaId}" class="dynamic-tab ${isActive ? 'active' : ''} shrink-0 border-b-2 font-medium px-1 py-4 text-sm">${area}</button>`;

                const tableId = `${viewPrefix}_${areaId}`;
                tablesContainer.insertAdjacentHTML('beforeend', createCourseTableShell(tableId, isActive));
                const tableBody = tablesContainer.querySelector(`#${tableId} tbody`);
                populateCourseTableBody(tableBody, coursesInArea, viewPrefix);
            });
        }
        
        function populateCourseTableBody(tableBody, courses, viewPrefix) {
            if (courses.length === 0) {
                tableBody.innerHTML = `<tr><td colspan="20" class="text-center py-10 text-gray-500">ไม่มีข้อมูล</td></tr>`;
                return;
            }
            courses.forEach(course => {
                let roomCells = '';
                const gradeKey = findGradeKeyByCourseId(course.id);
                const gradeLevel = gradeKey ? `ม.${gradeKey.replace('m', '')}` : '-';

                if (viewPrefix === 'course') {
                    for (let i = 1; i <= 15; i++) {
                        const hasCourse = course.rooms.includes(i);
                        roomCells += `<td onclick="toggleRoom('${gradeKey}', '${course.id}', ${i})" class="room-cell px-2 py-3 text-center text-sm font-bold ${hasCourse ? 'text-green-600' : 'text-gray-300'} border-b border-r border-gray-200">${hasCourse ? '✓' : '—'}</td>`;
                    }
                } else { // teaching view
                    for (let i = 1; i <= 15; i++) {
                        if (course.rooms.includes(i)) {
                            const assignmentKey = `${course.id}_${i}`;
                            const teacherIds = teachingAssignments[assignmentKey] || [];
                            let cellContent = '<span class="text-gray-500 italic">เลือกครู</span>';
                            let title = 'คลิกเพื่อเลือกครู';
                            if (teacherIds.length > 0) {
                                const teacherFirstNames = getTeacherFirstNames(teacherIds);
                                cellContent = teacherFirstNames.map(name => `<div class="whitespace-nowrap py-0.5">${name}</div>`).join('');
                                title = getTeacherNames(teacherIds).join(', ');
                            }
                            roomCells += `<td onclick="openTeacherSelectorModal('${course.id}', ${i})" class="room-cell px-2 py-1 align-top text-xs text-indigo-700 font-semibold text-left border-b border-r border-gray-200" title="${title}">${cellContent}</td>`;
                        } else {
                            roomCells += `<td class="bg-gray-100 border-b border-r border-gray-200"></td>`;
                        }
                    }
                }
                tableBody.innerHTML += `
                    <tr>
                        <td class="px-4 py-3 whitespace-nowrap text-sm font-medium text-gray-900 border-b border-r border-gray-200">${course.id}</td>
                        <td class="px-6 py-3 text-sm text-gray-700 border-b border-r border-gray-200">${course.name}</td>
                        <td class="px-3 py-3 text-center text-sm text-gray-700 border-b border-r border-gray-200">${course.periods}</td>
                        <td class="px-3 py-3 text-center text-sm text-gray-700 border-b border-r border-gray-200">${course.credits}</td>
                        <td class="px-3 py-3 text-center text-sm text-gray-700 border-b border-r border-gray-200">${gradeLevel}</td>
                        ${roomCells}
                    </tr>`;
            });
        }

        // --- TEACHER SUMMARY VIEW ---
        function classifyTeachersByGradeLevel() {
            const classified = { m1: [], m2: [], m3: [], m4: [], m5: [], m6: [], 'm1-3': [], 'm4-6': [], 'm1-6': [] };
            const teacherGrades = {}; // { teacherId: Set('m1', 'm4') }

            // 1. Map all grades taught by each teacher
            Object.entries(teachingAssignments).forEach(([key, teacherIds]) => {
                const [courseId] = key.split('_');
                const gradeKey = findGradeKeyByCourseId(courseId);
                if (gradeKey) {
                    teacherIds.forEach(id => {
                        if (!teacherGrades[id]) {
                            teacherGrades[id] = new Set();
                        }
                        teacherGrades[id].add(gradeKey);
                    });
                }
            });

            // 2. Classify each teacher based on their set of grades
            Object.entries(teacherGrades).forEach(([teacherId, gradesSet]) => {
                const teacherIdNum = parseInt(teacherId);
                const grades = Array.from(gradesSet);
                const numGrades = grades.length;
                const teachesLower = grades.some(g => ['m1', 'm2', 'm3'].includes(g));
                const teachesUpper = grades.some(g => ['m4', 'm5', 'm6'].includes(g));

                if (teachesLower && teachesUpper) {
                    classified['m1-6'].push(teacherIdNum);
                } else if (numGrades === 1) {
                    classified[grades[0]].push(teacherIdNum);
                } else if (teachesLower && numGrades > 1) {
                    classified['m1-3'].push(teacherIdNum);
                } else if (teachesUpper && numGrades > 1) {
                    classified['m4-6'].push(teacherIdNum);
                }
            });
            return classified;
        }

        function renderTeacherSummaryByGrade() {
            const tabsContainer = document.getElementById('teacher-dynamic-tabs');
            const tablesContainer = document.getElementById('teacher-tables-container');
            tabsContainer.innerHTML = '';
            tablesContainer.innerHTML = '';

            const classifiedTeachers = classifyTeachersByGradeLevel();

            const tabLayout = [
                [
                    { key: 'm1', label: 'ม.1' }, { key: 'm2', label: 'ม.2' }, { key: 'm3', label: 'ม.3' },
                    { key: 'm4', label: 'ม.4' }, { key: 'm5', label: 'ม.5' }, { key: 'm6', label: 'ม.6' }
                ],
                [
                    { key: 'm1-3', label: '[ม.1,2,3]' }, { key: 'm4-6', label: '[ม.4,5,6]' }, { key: 'm1-6', label: '[ม.1-6]' }
                ]
            ];

            const firstActiveTabKey = 'm1';
            let tabsHtml = '<div class="flex flex-col gap-2 w-full">';

            // Render all tabs unconditionally
            tabLayout.forEach(row => {
                tabsHtml += '<div class="flex flex-wrap gap-x-4 sm:gap-x-6">';
                row.forEach(tab => {
                    const isActive = tab.key === firstActiveTabKey;
                    tabsHtml += `<button onclick="changeActiveTab(event)" data-target="teacher_${tab.key}" class="dynamic-tab ${isActive ? 'active' : ''} shrink-0 border-b-2 font-medium px-1 py-4 text-sm">${tab.label}</button>`;
                });
                tabsHtml += '</div>';
            });
            tabsHtml += '</div>';
            tabsContainer.innerHTML = tabsHtml;

            // Render all table shells unconditionally
            const allTabKeys = tabLayout.flat().map(t => t.key);
            allTabKeys.forEach(key => {
                const teachersInGroup = classifiedTeachers[key] || [];
                const isActive = key === firstActiveTabKey;
                const tableId = `teacher_${key}`;
                tablesContainer.insertAdjacentHTML('beforeend', createTeacherTableShell(tableId, isActive));
                const tableBody = tablesContainer.querySelector(`#${tableId} tbody`);
                populateTeacherSummaryTable(tableBody, teachersInGroup, {});
            });
        }

        function renderTeacherSummaryByLearningArea() {
            const tabsContainer = document.getElementById('teacher-dynamic-tabs');
            const tablesContainer = document.getElementById('teacher-tables-container');
            tabsContainer.innerHTML = '';
            tablesContainer.innerHTML = '';

            let tabsHtml = '<div class="flex flex-wrap gap-x-4 sm:gap-x-6">';
            const firstActiveAreaId = LEARNING_AREAS.length > 0 ? LEARNING_AREAS[0].replace(/\s+/g, '') : '';

            LEARNING_AREAS.forEach(area => {
                const teachersInArea = getTeachersForLearningArea(area);
                const areaId = area.replace(/\s+/g, '');
                const isActive = areaId === firstActiveAreaId;
                
                // Render tab
                tabsHtml += `<button onclick="changeActiveTab(event)" data-target="teacher_${areaId}" class="dynamic-tab ${isActive ? 'active' : ''} shrink-0 border-b-2 font-medium px-1 py-4 text-sm">${area}</button>`;

                // Render table shell
                const tableId = `teacher_${areaId}`;
                tablesContainer.insertAdjacentHTML('beforeend', createTeacherTableShell(tableId, isActive));
                const tableBody = tablesContainer.querySelector(`#${tableId} tbody`);
                populateTeacherSummaryTable(tableBody, teachersInArea, { area: area });
            });
            
            tabsHtml += '</div>';
            tabsContainer.innerHTML = tabsHtml;
        }


        function populateTeacherSummaryTable(tableBody, teacherIds, context) {
            tableBody.innerHTML = '';
            if (teacherIds.length === 0) {
                tableBody.innerHTML = `<tr><td colspan="6" class="text-center py-10 text-gray-500">ไม่มีข้อมูลสำหรับแท็บนี้</td></tr>`;
                return;
            }
            const teachers = teacherData.filter(t => teacherIds.includes(t.id));

            teachers.forEach(teacher => {
                let allAssignments = getGroupedAssignmentsForTeacher(teacher.id);
                let filteredAssignments = allAssignments;

                // Context filtering is still useful for the 'learningArea' view
                if (context.area) {
                    filteredAssignments = allAssignments.filter(assign => {
                        const course = findCourseById(assign.courseId);
                        return course && course.learningArea === context.area;
                    });
                }
                
                if (filteredAssignments.length === 0) return;

                const rowCount = filteredAssignments.length;
                let totalPeriods = 0;
                filteredAssignments.forEach(assign => {
                    const course = findCourseById(assign.courseId);
                    if (course) totalPeriods += course.periods * assign.rooms.length;
                });

                filteredAssignments.forEach((assign, index) => {
                    const isFirstRow = index === 0;
                    const roomText = `${assign.grade}/${assign.rooms.join(', ')}`;
                    tableBody.innerHTML += `
                        <tr class="hover:bg-gray-50">
                            ${isFirstRow ? `<td rowspan="${rowCount}" class="px-6 py-3 align-top border-b border-gray-200 border-r"><div class="text-sm font-medium text-gray-900">${getTeacherFullName(teacher.id)}</div></td>` : ''}
                            <td class="px-6 py-3 text-sm text-gray-700 border-b border-gray-200 border-r">${assign.courseId}</td>
                            <td class="px-6 py-3 text-sm text-gray-700 border-b border-gray-200 border-r">${assign.courseName}</td>
                            <td class="px-3 py-3 text-center text-sm text-gray-700 border-b border-gray-200 border-r">${assign.periods}</td>
                            <td class="px-6 py-3 text-sm text-gray-700 border-b border-gray-200 border-r">${roomText}</td>
                            ${isFirstRow ? `<td rowspan="${rowCount}" class="px-6 py-3 text-center align-top border-b border-gray-200 text-sm font-semibold text-indigo-800">${totalPeriods}</td>` : ''}
                        </tr>`;
                });
            });
        }
        
        // --- EVENT HANDLERS & LOGIC ---
        function setCourseTeachingViewMode(mode) {
            if (courseTeachingViewMode === mode) return;
            courseTeachingViewMode = mode;
            renderAllViews();
        }

        function setTeacherSummaryViewMode(mode) {
            if (teacherSummaryViewMode === mode) return;
            teacherSummaryViewMode = mode;
            renderAllViews();
        }

        function updateAndRender(updateLogic) {
            const activeTabs = getActiveTabs();
            updateLogic();
            renderAllViews();
            restoreActiveTabs(activeTabs);
            saveDataToLocalStorage(); // <-- SAVE DATA ON EVERY UPDATE
        }

        function toggleRoom(gradeKey, courseId, roomNumber) {
            updateAndRender(() => {
                const course = courseData[gradeKey].courses.find(c => c.id === courseId);
                if (!course) return;
                const roomIndex = course.rooms.indexOf(roomNumber);
                if (roomIndex > -1) {
                    course.rooms.splice(roomIndex, 1);
                    delete teachingAssignments[`${courseId}_${roomNumber}`];
                } else {
                    course.rooms.push(roomNumber);
                    course.rooms.sort((a, b) => a - b);
                }
            });
        }
        
        function addTeacher() {
            const title = prompt("คำนำหน้า (นาย, นาง, นางสาว):");
            if (!title) return;
            const firstName = prompt("ชื่อ:");
            if (!firstName) return;
            const lastName = prompt("สกุล:");
            if (!lastName) return;
            const learningArea = prompt("กลุ่มสาระ:", LEARNING_AREAS.join(', '));
            if (!learningArea || !LEARNING_AREAS.includes(learningArea)) {
                alert("กลุ่มสาระไม่ถูกต้อง");
                return;
            }
            updateAndRender(() => {
                teacherData.push({ id: Date.now(), title, firstName, lastName, learningArea });
            });
        }

        function deleteTeacher(teacherId) {
            const teacher = teacherData.find(t => t.id === teacherId);
            if (confirm(`คุณแน่ใจหรือไม่ว่าต้องการลบ "${getTeacherFullName(teacherId)}"?`)) {
                updateAndRender(() => {
                    teacherData = teacherData.filter(t => t.id !== teacherId);
                    Object.keys(teachingAssignments).forEach(key => {
                        const teacherIds = teachingAssignments[key] || [];
                        const index = teacherIds.indexOf(teacherId);
                        if (index > -1) teacherIds.splice(index, 1);
                    });
                });
            }
        }

        function openTeacherSelectorModal(courseId, roomNumber) {
            currentAssignmentContext = { courseId, roomNumber };
            const modal = document.getElementById('teacher-selector-modal');
            const course = findCourseById(courseId);
            const assignmentKey = `${courseId}_${roomNumber}`;
            modalSelectedTeacherIds = teachingAssignments[assignmentKey] || [];

            let teacherCheckboxes = teacherData.map(teacher => `
                <label class="flex items-center p-2 rounded-md hover:bg-gray-100 cursor-pointer">
                    <input type="checkbox" value="${teacher.id}" class="h-5 w-5 text-indigo-600 rounded border-gray-300 focus:ring-indigo-500" ${modalSelectedTeacherIds.includes(teacher.id) ? 'checked' : ''}>
                    <span class="ml-3 text-sm text-gray-800">${getTeacherFullName(teacher.id)}</span>
                </label>
            `).join('');

            modal.innerHTML = `
                <div class="bg-white rounded-lg shadow-xl w-full max-w-lg transform transition-all">
                    <div class="p-6">
                        <div class="flex justify-between items-start">
                            <h3 class="text-lg font-semibold text-gray-800">เลือกครูผู้สอน</h3>
                            <button onclick="closeModal('teacher-selector-modal')" class="text-gray-400 hover:text-gray-600 text-3xl leading-none">&times;</button>
                        </div>
                        <p class="text-sm text-gray-600 mt-1">วิชา: ${course.name} (ห้อง ${roomNumber})</p>
                        
                        <!-- Filter Controls -->
                        <div class="grid grid-cols-2 gap-4 mt-4 pt-4 border-t">
                            <div>
                                <label for="teacher-filter-area" class="block text-sm font-medium text-gray-700">กลุ่มสาระ</label>
                                <select id="teacher-filter-area" oninput="filterAndRenderTeacherList()" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md">
                                    <option value="all">ทั้งหมด</option>
                                    ${LEARNING_AREAS.map(area => `<option value="${area}">${area}</option>`).join('')}
                                </select>
                            </div>
                            <div>
                                <label for="teacher-search-input" class="block text-sm font-medium text-gray-700">ค้นหาชื่อ</label>
                                <input type="text" id="teacher-search-input" oninput="filterAndRenderTeacherList()" placeholder="พิมพ์ชื่อ..." class="mt-1 block w-full border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md">
                            </div>
                        </div>

                        <div id="teacher-checkbox-list" class="mt-4 max-h-60 overflow-y-auto space-y-1 pr-2 border-t border-b py-2"></div>
                        <p id="modal-hint" class="text-xs text-gray-500 mt-2 h-4">เลือกได้สูงสุด 5 คน</p>
                        <div class="mt-4 flex justify-end space-x-3">
                            <button onclick="closeModal('teacher-selector-modal')" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300">ยกเลิก</button>
                            <button onclick="saveTeacherSelection()" class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700">บันทึก</button>
                        </div>
                    </div>
                </div>`;
            
            modal.classList.remove('hidden');
            document.getElementById('teacher-checkbox-list').addEventListener('change', handleModalCheckboxChange);
            filterAndRenderTeacherList(); // Initial render
        }

        function filterAndRenderTeacherList() {
            const listContainer = document.getElementById('teacher-checkbox-list');
            if (!listContainer) return;

            const selectedArea = document.getElementById('teacher-filter-area').value;
            const searchTerm = document.getElementById('teacher-search-input').value.toLowerCase();
            
            let filteredTeachers = teacherData;

            if (selectedArea !== 'all') {
                filteredTeachers = filteredTeachers.filter(t => t.learningArea === selectedArea);
            }

            if (searchTerm) {
                filteredTeachers = filteredTeachers.filter(t => getTeacherFullName(t.id).toLowerCase().includes(searchTerm));
            }

            listContainer.innerHTML = filteredTeachers.map(teacher => {
                const isChecked = modalSelectedTeacherIds.includes(teacher.id);
                return `
                    <label class="flex items-center p-2 rounded-md hover:bg-gray-100 cursor-pointer">
                        <input type="checkbox" value="${teacher.id}" class="h-5 w-5 text-indigo-600 rounded border-gray-300 focus:ring-indigo-500" ${isChecked ? 'checked' : ''}>
                        <span class="ml-3 text-sm text-gray-800">${getTeacherFullName(teacher.id)}</span>
                    </label>
                `;
            }).join('');
            
            handleCheckboxLimit();
        }

        function handleModalCheckboxChange(event) {
            const teacherId = parseInt(event.target.value);
            const isChecked = event.target.checked;

            if (isChecked) {
                if (!modalSelectedTeacherIds.includes(teacherId)) {
                    modalSelectedTeacherIds.push(teacherId);
                }
            } else {
                const index = modalSelectedTeacherIds.indexOf(teacherId);
                if (index > -1) {
                    modalSelectedTeacherIds.splice(index, 1);
                }
            }
            
            handleCheckboxLimit(event); 
        }

        function handleCheckboxLimit(event) {
            const hint = document.getElementById('modal-hint');
            if (modalSelectedTeacherIds.length > 5) {
                if (event) {
                    event.target.checked = false;
                    const teacherId = parseInt(event.target.value);
                    const index = modalSelectedTeacherIds.indexOf(teacherId);
                    if (index > -1) {
                        modalSelectedTeacherIds.splice(index, 1);
                    }
                }
                hint.classList.add('text-red-500', 'font-semibold');
                hint.innerText = 'ไม่สามารถเลือกครูเกิน 5 คนได้';
            } else {
                hint.classList.remove('text-red-500', 'font-semibold');
                hint.innerText = `เลือกแล้ว ${modalSelectedTeacherIds.length}/5 คน`;
            }
        }

        function saveTeacherSelection() {
            updateAndRender(() => {
                const { courseId, roomNumber } = currentAssignmentContext;
                const assignmentKey = `${courseId}_${roomNumber}`;
                
                if (modalSelectedTeacherIds.length > 0) {
                    teachingAssignments[assignmentKey] = [...modalSelectedTeacherIds];
                } else {
                    delete teachingAssignments[assignmentKey];
                }
            });
            closeModal('teacher-selector-modal');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.add('hidden');
            modalSelectedTeacherIds = [];
        }

        // --- UTILITY FUNCTIONS ---
        
        /**
         * Saves all primary data stores to the browser's localStorage.
         */
        function saveDataToLocalStorage() {
            try {
                localStorage.setItem('courseData', JSON.stringify(courseData));
                localStorage.setItem('teacherData', JSON.stringify(teacherData));
                localStorage.setItem('teachingAssignments', JSON.stringify(teachingAssignments));
                console.log("Data saved to localStorage.");
            } catch (error) {
                console.error("Could not save data to localStorage:", error);
                showNotification("เกิดข้อผิดพลาดในการบันทึกข้อมูล", true);
            }
        }

        /**
         * Loads data from localStorage on page startup. If data exists, it overwrites the default data.
         */
        function loadDataFromLocalStorage() {
            try {
                const savedCourses = localStorage.getItem('courseData');
                const savedTeachers = localStorage.getItem('teacherData');
                const savedAssignments = localStorage.getItem('teachingAssignments');

                if (savedCourses) {
                    courseData = JSON.parse(savedCourses);
                    console.log("Loaded courseData from localStorage.");
                }
                if (savedTeachers) {
                    teacherData = JSON.parse(savedTeachers);
                    console.log("Loaded teacherData from localStorage.");
                }
                if (savedAssignments) {
                    teachingAssignments = JSON.parse(savedAssignments);
                    console.log("Loaded teachingAssignments from localStorage.");
                }
            } catch (error) {
                console.error("Could not load data from localStorage:", error);
                showNotification("ไม่สามารถโหลดข้อมูลที่บันทึกไว้ได้", true);
            }
        }

        function getActiveTabs() {
            const active = {};
            const mainTab = document.querySelector('.main-tab-active');
            if (mainTab) {
                active.main = mainTab.id.replace('-main-tab', '');
            }
            
            const prefixes = ['teacherList', 'course', 'teaching', 'teacher'];
            active.dynamic = {};
            prefixes.forEach(prefix => {
                const tab = document.querySelector(`#${prefix}-dynamic-tabs .dynamic-tab.active`);
                if (tab) {
                    active.dynamic[prefix] = tab.dataset.target;
                }
            });
            return active;
        }

        function restoreActiveTabs(tabs) {
            if (tabs.main) {
                changeMainView(tabs.main);
            }
            for (const prefix in tabs.dynamic) {
                if (tabs.dynamic[prefix]) {
                    const parentView = document.getElementById(`${prefix}-view`);
                    if (parentView) {
                        parentView.querySelectorAll('.dynamic-tab').forEach(t => t.classList.remove('active'));
                        parentView.querySelectorAll('.table-container').forEach(c => c.classList.remove('active'));

                        const tabToActivate = parentView.querySelector(`.dynamic-tab[data-target="${tabs.dynamic[prefix]}"]`);
                        if (tabToActivate) {
                            tabToActivate.classList.add('active');
                            const tableToActivate = parentView.querySelector(`#${tabs.dynamic[prefix]}`);
                            if (tableToActivate) {
                                tableToActivate.classList.add('active');
                            }
                        }
                    }
                }
            }
        }

        function findCourseById(courseId) {
            for (const gradeKey in courseData) {
                const course = courseData[gradeKey].courses.find(c => c.id === courseId);
                if (course) return course;
            }
            return null;
        }
        
        function findGradeKeyByCourseId(courseId) {
             for (const gradeKey in courseData) {
                if (courseData[gradeKey].courses.some(c => c.id === courseId)) return gradeKey;
            }
            return null;
        }

        function getTeacherFullName(teacherId) {
            const teacher = teacherData.find(t => t.id === teacherId);
            return teacher ? `${teacher.title} ${teacher.firstName} ${teacher.lastName}` : 'ไม่พบชื่อ';
        }
        
        function findTeacherIdByName(fullName) {
            if (!fullName) return null;
            const teacher = teacherData.find(t => {
                const tFullName = `${t.title}${t.firstName} ${t.lastName}`;
                return tFullName.replace(/\s/g, '') === fullName.trim().replace(/\s/g, '');
            });
            return teacher ? teacher.id : null;
        }


        function getTeacherNames(teacherIds) {
            return teacherIds.map(id => getTeacherFullName(id));
        }

        function getTeacherFirstNames(teacherIds) {
            return teacherIds.map(id => {
                const teacher = teacherData.find(t => t.id === id);
                return teacher ? teacher.firstName : 'ไม่พบชื่อ';
            });
        }
        
        function getTeachersForLearningArea(area) {
            const teacherIdSet = new Set();
            const allCourses = Object.values(courseData).flatMap(g => g.courses);
            const coursesInArea = allCourses.filter(c => c.learningArea === area);
            coursesInArea.forEach(course => {
                Object.keys(teachingAssignments).forEach(key => {
                    if (key.startsWith(course.id)) {
                        teachingAssignments[key].forEach(id => teacherIdSet.add(id));
                    }
                });
            });
            return Array.from(teacherIdSet);
        }

        function getGroupedAssignmentsForTeacher(teacherId) {
            const assignmentsByCourse = {};
            Object.entries(teachingAssignments).forEach(([key, teacherIds]) => {
                if (teacherIds.includes(teacherId)) {
                    const [courseId, room] = key.split('_');
                    if (!assignmentsByCourse[courseId]) {
                        const course = findCourseById(courseId);
                        const gradeKey = findGradeKeyByCourseId(courseId);
                        assignmentsByCourse[courseId] = {
                            courseId: courseId,
                            courseName: course ? course.name : 'N/A',
                            periods: course ? course.periods : 0,
                            grade: `ม.${gradeKey ? gradeKey.replace('m', '') : '?'}`,
                            gradeKey: gradeKey,
                            rooms: []
                        };
                    }
                    assignmentsByCourse[courseId].rooms.push(parseInt(room));
                }
            });
            return Object.values(assignmentsByCourse).map(a => {
                a.rooms.sort((x, y) => x - y);
                return a;
            });
        }

        // --- TAB SWITCHING ---
        function changeMainView(viewName) {
            document.querySelectorAll('.view-container').forEach(v => v.classList.remove('active'));
            document.getElementById(`${viewName}-view`).classList.add('active');
            document.querySelectorAll('.main-tab-active').forEach(t => t.classList.remove('main-tab-active'));
            document.getElementById(`${viewName}-main-tab`).classList.add('main-tab-active');
        }

        function changeActiveTab(event) {
            const targetId = event.currentTarget.dataset.target;
            const parentView = event.currentTarget.closest('.view-container');
            parentView.querySelectorAll('.table-container').forEach(c => c.classList.remove('active'));
            parentView.querySelector(`#${targetId}`).classList.add('active');
            parentView.querySelectorAll('.dynamic-tab').forEach(tab => tab.classList.remove('active'));
            event.currentTarget.classList.add('active');
        }
        
        // --- TEMPLATE DOWNLOAD FUNCTIONS ---
        function downloadTeacherTemplate() {
            const workbook = XLSX.utils.book_new();

            LEARNING_AREAS.forEach(area => {
                let teachersInArea = teacherData.filter(t => t.learningArea === area);
                
                let data = teachersInArea.map(t => ({
                    "รหัสครู": t.id,
                    "คำนำหน้า": t.title,
                    "ชื่อ": t.firstName,
                    "สกุล": t.lastName,
                    "กลุ่มสาระ": t.learningArea
                }));

                if (data.length === 0) {
                    data.push({ "รหัสครู": "", "คำนำหน้า": "", "ชื่อ": "", "สกุล": "", "กลุ่มสาระ": area });
                }

                const worksheet = XLSX.utils.json_to_sheet(data);
                const sheetName = area.substring(0, 31).replace(/[*?:/\\\[\]]/g, '_');
                XLSX.utils.book_append_sheet(workbook, worksheet, sheetName);
            });

            XLSX.writeFile(workbook, "ไฟล์รายชื่อครู_ตามกลุ่มสาระ.xlsx");
        }

        function downloadCourseTemplate() {
            const workbook = XLSX.utils.book_new();
            const allCourses = Object.values(courseData).flatMap(grade => grade.courses);

            LEARNING_AREAS.forEach(area => {
                const coursesInArea = allCourses.filter(c => c.learningArea === area);

                let data = coursesInArea.map(course => {
                    const gradeKey = findGradeKeyByCourseId(course.id);
                    const gradeLevel = gradeKey ? `ม.${gradeKey.replace('m', '')}` : '-';
                    
                    let row = {
                        "รหัสวิชา": course.id,
                        "ชื่อวิชา": course.name,
                        "คาบ/สัปดาห์": course.periods,
                        "หน่วยกิต": course.credits,
                        "ม.": gradeLevel
                    };

                    for (let i = 1; i <= 15; i++) {
                        row[`ห้อง${i}`] = course.rooms.includes(i) ? "/" : "";
                    }
                    return row;
                });

                if (data.length === 0) {
                    let exampleRow = { "รหัสวิชา": "", "ชื่อวิชา": "", "คาบ/สัปดาห์": "", "หน่วยกิต": "", "ม.": "" };
                    for (let i = 1; i <= 15; i++) exampleRow[`ห้อง${i}`] = "";
                    data.push(exampleRow);
                }

                const worksheet = XLSX.utils.json_to_sheet(data);
                const sheetName = area.substring(0, 31).replace(/[*?:/\\\[\]]/g, '_');
                XLSX.utils.book_append_sheet(workbook, worksheet, sheetName);
            });

            XLSX.writeFile(workbook, "ไฟล์รายวิชา_ตามกลุ่มสาระ.xlsx");
        }

        // --- FILE UPLOAD HANDLERS ---
        function handleTeacherFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    
                    let newTeacherData = [];
                    let hasValidData = false;

                    workbook.SheetNames.forEach(sheetName => {
                        const worksheet = workbook.Sheets[sheetName];
                        const json = XLSX.utils.sheet_to_json(worksheet);

                        if (json.length > 0) {
                            const firstRow = json[0];
                            const expectedHeaders = ["รหัสครู", "คำนำหน้า", "ชื่อ", "สกุล", "กลุ่มสาระ"];
                            const actualHeaders = Object.keys(firstRow);
                            
                            // Check if all expected headers are present
                            const headersOk = expectedHeaders.every(h => actualHeaders.includes(h));

                            if (headersOk) {
                                hasValidData = true;
                                json.forEach(row => {
                                    // Ensure row has data before pushing
                                    if (row["รหัสครู"] && row["ชื่อ"]) {
                                        newTeacherData.push({
                                            id: row["รหัสครู"],
                                            title: row["คำนำหน้า"],
                                            firstName: row["ชื่อ"],
                                            lastName: row["สกุล"],
                                            learningArea: row["กลุ่มสาระ"],
                                        });
                                    }
                                });
                            } else {
                                console.warn(`Sheet "${sheetName}" has incorrect headers. Skipping.`);
                            }
                        }
                    });

                    if (!hasValidData) {
                        showNotification("ไม่พบข้อมูลที่ถูกต้องในไฟล์", true);
                        return;
                    }
                    
                    updateAndRender(() => {
                        teacherData = newTeacherData;
                    });
                    showNotification("อัปโหลดรายชื่อครูสำเร็จ", false);

                } catch (error) {
                    console.error("Upload Error:", error);
                    showNotification("เกิดข้อผิดพลาดในการอ่านไฟล์", true);
                }
            };
            reader.readAsArrayBuffer(file);
            event.target.value = ''; 
        }

        function handleCourseFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    
                    const newCourseData = {};
                    let hasValidData = false;

                    workbook.SheetNames.forEach(sheetName => {
                        const worksheet = workbook.Sheets[sheetName];
                        const json = XLSX.utils.sheet_to_json(worksheet);
                        
                        if (json.length > 0) {
                            const firstRow = json[0];
                            const expectedHeaders = ["รหัสวิชา", "ชื่อวิชา", "คาบ/สัปดาห์", "หน่วยกิต", "ม."];
                            const actualHeaders = Object.keys(firstRow);
                            const headersOk = expectedHeaders.every(h => actualHeaders.includes(h));

                            if(headersOk) {
                                hasValidData = true;
                                json.forEach(row => {
                                    const subjectCode = row["รหัสวิชา"];
                                    if (!subjectCode || !row["ม."]) return;

                                    const gradeStr = String(row["ม."]).match(/\d+/);
                                    if (!gradeStr) return;
                                    const gradeKey = `m${gradeStr[0]}`;

                                    if (!newCourseData[gradeKey]) {
                                        newCourseData[gradeKey] = { name: `ม. ${gradeStr[0]}`, courses: [] };
                                    }
                                    
                                    const rooms = [];
                                    for (let i = 1; i <= 15; i++) {
                                        if (row[`ห้อง${i}`] === '/') {
                                            rooms.push(i);
                                        }
                                    }
                                    
                                    // Try to preserve learning area if course already exists
                                    const existingCourse = findCourseById(subjectCode);
                                    const learningArea = existingCourse ? existingCourse.learningArea : sheetName.replace(/_/g, ' ');

                                    newCourseData[gradeKey].courses.push({
                                        id: subjectCode,
                                        name: row["ชื่อวิชา"],
                                        periods: row["คาบ/สัปดาห์"],
                                        credits: row["หน่วยกิต"],
                                        learningArea: learningArea,
                                        rooms: rooms
                                    });
                                });
                            } else {
                                 console.warn(`Sheet "${sheetName}" has incorrect headers. Skipping.`);
                            }
                        }
                    });

                    if (!hasValidData) {
                        showNotification("ไม่พบข้อมูลที่ถูกต้องในไฟล์", true);
                        return;
                    }

                    updateAndRender(() => {
                        courseData = newCourseData;
                        teachingAssignments = {}; // Clear assignments as they are not in the new file format
                    });
                    showNotification("อัปโหลดรายวิชาสำเร็จ", false);

                } catch (error) {
                    console.error("Upload Error:", error);
                    showNotification("เกิดข้อผิดพลาดในการอ่านไฟล์: " + error.message, true);
                }
            };
            reader.readAsArrayBuffer(file);
            event.target.value = '';
        }


        function showNotification(message, isError = false) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.style.backgroundColor = isError ? '#ef4444' : '#22c55e';
            notification.classList.add('show');
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // --- Generic Table Shell Creators ---
        function createCourseTableShell(id, isActive) {
            let roomHeaders = '';
            for(let i=1; i<=15; i++) roomHeaders += `<th scope="col" class="px-2 py-3 text-center text-xs font-bold text-gray-600 uppercase tracking-wider border-r">ห้อง<br>${i}</th>`;
            return `
                <div id="${id}" class="table-container ${isActive ? 'active' : ''}">
                    <div class="overflow-x-auto bg-white rounded-lg shadow">
                        <table class="min-w-full">
                            <thead class="bg-gray-100">
                                <tr>
                                    <th scope="col" class="px-4 py-3 text-left text-xs font-bold text-gray-600 uppercase tracking-wider border-r">รหัสวิชา</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-bold text-gray-600 uppercase tracking-wider border-r">ชื่อวิชา</th>
                                    <th scope="col" class="px-3 py-3 text-center text-xs font-bold text-gray-600 uppercase tracking-wider border-r">คาบ/<br>สัปดาห์</th>
                                    <th scope="col" class="px-3 py-3 text-center text-xs font-bold text-gray-600 uppercase tracking-wider border-r">หน่วย<br>กิต</th>
                                    <th scope="col" class="px-3 py-3 text-center text-xs font-bold text-gray-600 uppercase tracking-wider border-r">ม.</th>
                                    ${roomHeaders}
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>`;
        }

        function createTeacherTableShell(id, isActive) {
             return `
                <div id="${id}" class="table-container ${isActive ? 'active' : ''}">
                    <div class="overflow-x-auto bg-white rounded-lg shadow">
                        <table class="min-w-full" style="table-layout: auto;">
                            <thead class="bg-gray-100">
                                <tr>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-bold text-gray-600 uppercase tracking-wider border-r">ครู</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-bold text-gray-600 uppercase tracking-wider border-r">รหัสวิชา</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-bold text-gray-600 uppercase tracking-wider border-r">วิชา</th>
                                    <th scope="col" class="px-3 py-3 text-center text-xs font-bold text-gray-600 uppercase tracking-wider border-r">คาบ/สัปดาห์</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-bold text-gray-600 uppercase tracking-wider border-r">ห้องที่สอน</th>
                                    <th scope="col" class="px-6 py-3 text-center text-xs font-bold text-gray-600 uppercase tracking-wider">คาบสอน/สัปดาห์</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>`;
        }
        
        function createTeacherListTableShell(id, isActive) {
            return `
                <div id="${id}" class="table-container ${isActive ? 'active' : ''}">
                    <div class="overflow-x-auto bg-white rounded-lg shadow">
                        <table class="min-w-full" style="table-layout: auto;">
                            <thead class="bg-gray-100">
                                <tr>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-bold text-gray-600 uppercase tracking-wider border-r">รหัสครู</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-bold text-gray-600 uppercase tracking-wider border-r">คำนำหน้า</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-bold text-gray-600 uppercase tracking-wider border-r">ชื่อ</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-bold text-gray-600 uppercase tracking-wider border-r">สกุล</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-bold text-gray-600 uppercase tracking-wider">กลุ่มสาระ</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>`;
        }
    </script>
</body>
</html>
